"use strict";(self.webpackChunkkaito_website=self.webpackChunkkaito_website||[]).push([[1991],{53:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/files/custom-deployment-template-c949c35527d95d3b212d26befc73ad72.yaml"},4251:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/files/Dockerfile-7eb684747dd83e1f91016257edf96882.reference"},8453:(e,t,i)=>{i.d(t,{R:()=>s,x:()=>l});var n=i(6540);const o={},r=n.createContext(o);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(r.Provider,{value:t},e.children)}},8484:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/files/reference-image-deployment-b5aedc318b1e8d8ec11a1a0820dc0129.yaml"},8608:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"custom-model","title":"Custom Model Integration","description":"Option 1: Use Pre-Built Docker Image Without Model Weights","source":"@site/versioned_docs/version-v0.5.x/custom-model.md","sourceDirName":".","slug":"/custom-model","permalink":"/kaito/docs/v0.5.x/custom-model","draft":false,"unlisted":false,"editUrl":"https://github.com/kaito-project/kaito/tree/main/website/versioned_docs/version-v0.5.x/custom-model.md","tags":[],"version":"v0.5.x","frontMatter":{"title":"Custom Model Integration"},"sidebar":"sidebar","previous":{"title":"Retrieval-Augmented Generation (RAG)","permalink":"/kaito/docs/v0.5.x/rag"},"next":{"title":"Tool Calling","permalink":"/kaito/docs/v0.5.x/tool-calling"}}');var o=i(4848),r=i(8453);const s={title:"Custom Model Integration"},l=void 0,a={},c=[{value:"Option 1: Use Pre-Built Docker Image Without Model Weights",id:"option-1-use-pre-built-docker-image-without-model-weights",level:2},{value:"Option 2: Build a Custom Docker Image with Model Weights",id:"option-2-build-a-custom-docker-image-with-model-weights",level:2},{value:"Step 1: Clone the Repository",id:"step-1-clone-the-repository",level:3},{value:"Step 2: Download Your Private/Custom Model Weights",id:"step-2-download-your-privatecustom-model-weights",level:3},{value:"Step 3: Log In to Your Container Registry",id:"step-3-log-in-to-your-container-registry",level:3},{value:"Step 4: Build Docker Image with Private/Custom Weights",id:"step-4-build-docker-image-with-privatecustom-weights",level:3},{value:"Step 5: Deploy",id:"step-5-deploy",level:3}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"option-1-use-pre-built-docker-image-without-model-weights",children:"Option 1: Use Pre-Built Docker Image Without Model Weights"}),"\n",(0,o.jsxs)(t.p,{children:["If you want to avoid building a Docker image with model weights, use our pre-built reference image (",(0,o.jsx)(t.code,{children:"ghcr.io/kaito-project/kaito/llm-reference-preset:latest"}),"). This image, built with ",(0,o.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(4251).A+"",children:"Dockerfile.reference"}),", dynamically downloads model weights from HuggingFace at runtime, reducing the need to create and maintain custom images."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(8484).A+"",children:"Sample Deployment YAML"})})}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"option-2-build-a-custom-docker-image-with-model-weights",children:"Option 2: Build a Custom Docker Image with Model Weights"}),"\n",(0,o.jsx)(t.h3,{id:"step-1-clone-the-repository",children:"Step 1: Clone the Repository"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"git clone https://github.com/kaito-project/kaito.git\n"})}),"\n",(0,o.jsx)(t.h3,{id:"step-2-download-your-privatecustom-model-weights",children:"Step 2: Download Your Private/Custom Model Weights"}),"\n",(0,o.jsx)(t.p,{children:"For example, assuming HuggingFace weights:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"git lfs install\ngit clone git@hf.co:<MODEL_ID>  # Example: git clone git@hf.co:bigscience/bloom\n# OR\ngit clone https://huggingface.co/bigscience/bloom\n"})}),"\n",(0,o.jsx)(t.p,{children:"Alternatively, use curl:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"curl -sSL https://huggingface.co/bigscience/bloom/resolve/main/config.json?download=true -o config.json\n"})}),"\n",(0,o.jsxs)(t.p,{children:["More information on downloading models from HuggingFace can be found ",(0,o.jsx)(t.a,{href:"https://huggingface.co/docs/hub/en/models-downloading",children:"here"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"step-3-log-in-to-your-container-registry",children:"Step 3: Log In to Your Container Registry"}),"\n",(0,o.jsx)(t.p,{children:"Before pushing the Docker image, ensure you\u2019re logged into the appropriate container registry. Here are general login methods depending on the registry you use:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"GitHub Container Registry (ghcr.io):"}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"echo $CR_PAT | docker login ghcr.io -u USERNAME --password-stdin\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Replace CR_PAT with your GitHub Personal Access Token and USERNAME with your GitHub username. This token should have the write",":packages"," and read",":packages"," permissions."]}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsx)(t.li,{children:"Azure Container Registry (ACR): If you're using ACR:"}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"az acr login --name <REGISTRY_NAME>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Replace ",(0,o.jsx)(t.code,{children:"<REGISTRY_NAME>"})," with your Azure Container Registry name."]}),"\n",(0,o.jsxs)(t.ol,{start:"3",children:["\n",(0,o.jsx)(t.li,{children:"Docker Hub or Other Container Registries:"}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"docker login <REGISTRY_URL>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Enter your username and password when prompted. Replace ",(0,o.jsx)(t.code,{children:"<REGISTRY_URL>"})," with your registry URL, such as ",(0,o.jsx)(t.code,{children:"docker.io"})," for Docker Hub."]}),"\n",(0,o.jsx)(t.h3,{id:"step-4-build-docker-image-with-privatecustom-weights",children:"Step 4: Build Docker Image with Private/Custom Weights"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Set Environment Variables"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Before building the Docker image, set the relevant environment variables for the image name, version, and weights path:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:'export IMAGE_NAME="modelsregistry.azurecr.io/phi-3-mini-4k-instruct:0.0.1"\nexport VERSION="0.0.1"\nexport WEIGHTS_PATH="kaito/phi-3-mini-4k-instruct/weights"\n'})}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsx)(t.li,{children:"Build and Push the Docker Image"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Navigate to the KAITO base directory and build the Docker image, ensuring the weights directory is included in the build context:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"docker build -t <IMAGE_NAME> --file docker/presets/workspace/models/tfs/Dockerfile --build-arg WEIGHTS_PATH=<WEIGHTS_PATH> --build-arg MODEL_TYPE=text-generation --build-arg VERSION=<VERSION> .\n\ndocker push <IMAGE_NAME>\n"})}),"\n",(0,o.jsx)(t.h3,{id:"step-5-deploy",children:"Step 5: Deploy"}),"\n",(0,o.jsxs)(t.p,{children:["Follow the ",(0,o.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(53).A+"",children:"Custom Template"})]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);