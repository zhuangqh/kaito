"use strict";(self.webpackChunkkaito_website=self.webpackChunkkaito_website||[]).push([[1896],{5926:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"azure","title":"Azure Setup","description":"This guide covers setting up auto-provisioning capabilities for KAITO on Azure Kubernetes Service (AKS). Auto-provisioning allows KAITO to automatically create GPU nodes when needed for your AI workloads.","source":"@site/versioned_docs/version-v0.6.x/azure.md","sourceDirName":".","slug":"/azure","permalink":"/kaito/docs/azure","draft":false,"unlisted":false,"editUrl":"https://github.com/kaito-project/kaito/tree/main/website/versioned_docs/version-v0.6.x/azure.md","tags":[],"version":"v0.6.x","frontMatter":{"title":"Azure Setup"},"sidebar":"sidebar","previous":{"title":"FAQ","permalink":"/kaito/docs/faq"},"next":{"title":"AWS Setup","permalink":"/kaito/docs/aws"}}');var r=i(4848),t=i(8453);const o={title:"Azure Setup"},a=void 0,l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Understanding Auto-Provisioning on Azure",id:"understanding-auto-provisioning-on-azure",level:2},{value:"When to Use Auto-Provisioning",id:"when-to-use-auto-provisioning",level:3},{value:"Set Up Auto-Provisioning",id:"set-up-auto-provisioning",level:2},{value:"Step 1: Create and configure an AKS Cluster",id:"step-1-create-and-configure-an-aks-cluster",level:3},{value:"Step 2: Create Managed Identity",id:"step-2-create-managed-identity",level:3},{value:"Step 3: Install GPU Provisioner",id:"step-3-install-gpu-provisioner",level:3},{value:"Step 4: Create Federated Credential",id:"step-4-create-federated-credential",level:3},{value:"Verify Setup",id:"verify-setup",level:2},{value:"Using Auto-Provisioning",id:"using-auto-provisioning",level:2},{value:"Supported Azure GPU Instance Types",id:"supported-azure-gpu-instance-types",level:2},{value:"Clean Up",id:"clean-up",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This guide covers setting up auto-provisioning capabilities for KAITO on Azure Kubernetes Service (AKS). Auto-provisioning allows KAITO to automatically create GPU nodes when needed for your AI workloads."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["An AKS cluster with KAITO workspace controller installed","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["See ",(0,r.jsx)(n.a,{href:"#step-1-create-and-configure-an-aks-cluster",children:"Step 1"})," to create an AKS cluster"]}),"\n",(0,r.jsxs)(n.li,{children:["See ",(0,r.jsx)(n.a,{href:"installation",children:"Installation"})," to install the KAITO workspace controller"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/cli/azure/install-azure-cli",children:"Azure CLI"})," for managing Azure resources"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"kubectl"})," configured to access your AKS cluster"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"understanding-auto-provisioning-on-azure",children:"Understanding Auto-Provisioning on Azure"}),"\n",(0,r.jsxs)(n.p,{children:["KAITO can use the ",(0,r.jsx)(n.a,{href:"https://github.com/Azure/gpu-provisioner",children:"Azure GPU Provisioner"})," to automatically provision GPU nodes. This controller:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creates new GPU nodes when workspaces require specific instance types"}),"\n",(0,r.jsx)(n.li,{children:"Supports various Azure GPU SKUs (Standard_NC series, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"Manages node lifecycle based on workload demands"}),"\n",(0,r.jsx)(n.li,{children:"Integrates with Azure's managed identity system for secure access"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-auto-provisioning",children:"When to Use Auto-Provisioning"}),"\n",(0,r.jsx)(n.p,{children:"Choose auto-provisioning when:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You want KAITO to manage GPU node creation automatically"}),"\n",(0,r.jsx)(n.li,{children:"Your workloads have varying GPU requirements"}),"\n",(0,r.jsx)(n.li,{children:"You prefer to specify exact Azure instance types in your workspaces"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["Alternative: If you already have GPU nodes or manage them separately, use the ",(0,r.jsx)(n.a,{href:"quick-start#option-1-using-preferred-nodes-existing-gpu-nodes",children:"preferred nodes approach"})," instead."]})}),"\n",(0,r.jsx)(n.h2,{id:"set-up-auto-provisioning",children:"Set Up Auto-Provisioning"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-and-configure-an-aks-cluster",children:"Step 1: Create and configure an AKS Cluster"}),"\n",(0,r.jsx)(n.p,{children:"If you don't have an AKS cluster yet, you can create one using the Azure CLI:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'export RESOURCE_GROUP="kaito-rg"\nexport CLUSTER_NAME="kaito-cluster"\nexport LOCATION="eastus"\naz group create --name $RESOURCE_GROUP --location $LOCATION\naz aks create --resource-group $RESOURCE_GROUP --name $CLUSTER_NAME --enable-oidc-issuer --enable-workload-identity --enable-managed-identity --generate-ssh-keys\n'})}),"\n",(0,r.jsx)(n.p,{children:"Connect to the cluster:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"az aks get-credentials --resource-group $RESOURCE_GROUP --name $CLUSTER_NAME\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-managed-identity",children:"Step 2: Create Managed Identity"}),"\n",(0,r.jsx)(n.p,{children:"Create a managed identity for the GPU provisioner with the necessary permissions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'export SUBSCRIPTION=$(az account show --query id -o tsv)\nexport IDENTITY_NAME="kaitoprovisioner"\n\n# Create the managed identity\naz identity create --name $IDENTITY_NAME -g $RESOURCE_GROUP\n\n# Get the principal ID for role assignment\nexport IDENTITY_PRINCIPAL_ID=$(az identity show --name $IDENTITY_NAME -g $RESOURCE_GROUP --subscription $SUBSCRIPTION --query \'principalId\' -o tsv)\n\n# Assign Contributor role to the cluster\naz role assignment create \\\n  --assignee $IDENTITY_PRINCIPAL_ID \\\n  --scope /subscriptions/$SUBSCRIPTION/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.ContainerService/managedClusters/$CLUSTER_NAME \\\n  --role "Contributor"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-install-gpu-provisioner",children:"Step 3: Install GPU Provisioner"}),"\n",(0,r.jsx)(n.p,{children:"Install the Azure GPU Provisioner using Helm:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export GPU_PROVISIONER_VERSION=0.3.5\n\n# Download and configure Helm values\ncurl -sO https://raw.githubusercontent.com/Azure/gpu-provisioner/main/hack/deploy/configure-helm-values.sh\nchmod +x ./configure-helm-values.sh && ./configure-helm-values.sh $CLUSTER_NAME $RESOURCE_GROUP $IDENTITY_NAME\n\n# Install GPU provisioner\nhelm install gpu-provisioner \\\n  --values gpu-provisioner-values.yaml \\\n  --set settings.azure.clusterName=$CLUSTER_NAME \\\n  --wait \\\n  https://github.com/Azure/gpu-provisioner/raw/gh-pages/charts/gpu-provisioner-$GPU_PROVISIONER_VERSION.tgz \\\n  --namespace gpu-provisioner \\\n  --create-namespace\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-create-federated-credential",children:"Step 4: Create Federated Credential"}),"\n",(0,r.jsx)(n.p,{children:"Create the federated identity credential to allow the GPU provisioner to access Azure resources:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'export AKS_OIDC_ISSUER=$(az aks show -n $CLUSTER_NAME -g $RESOURCE_GROUP --subscription $SUBSCRIPTION --query "oidcIssuerProfile.issuerUrl" -o tsv)\n\naz identity federated-credential create \\\n  --name kaito-federatedcredential \\\n  --identity-name $IDENTITY_NAME \\\n  -g $RESOURCE_GROUP \\\n  --issuer $AKS_OIDC_ISSUER \\\n  --subject system:serviceaccount:"gpu-provisioner:gpu-provisioner" \\\n  --audience api://AzureADTokenExchange \\\n  --subscription $SUBSCRIPTION\n'})}),"\n",(0,r.jsx)(n.h2,{id:"verify-setup",children:"Verify Setup"}),"\n",(0,r.jsx)(n.p,{children:"Check that the GPU provisioner is running correctly:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check Helm installations\nhelm list -n gpu-provisioner\nhelm list -n kaito-workspace\n\n# Check GPU provisioner status\nkubectl describe deploy gpu-provisioner -n gpu-provisioner\nkubectl get pods -n gpu-provisioner\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The GPU provisioner pod should be in a ",(0,r.jsx)(n.code,{children:"Running"})," state. If it's failing, check the logs:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl logs --selector=app.kubernetes.io/name=gpu-provisioner -n gpu-provisioner\n"})}),"\n",(0,r.jsx)(n.h2,{id:"using-auto-provisioning",children:"Using Auto-Provisioning"}),"\n",(0,r.jsx)(n.p,{children:"Once set up, you can create workspaces that automatically provision GPU nodes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="phi-4-workspace.yaml"',children:'apiVersion: kaito.sh/v1beta1\nkind: Workspace\nmetadata:\n  name: workspace-phi-4-mini\nresource:\n  instanceType: "Standard_NC6s_v3"  # Will trigger node creation\n  labelSelector:\n    matchLabels:\n      apps: phi-4-mini\ninference:\n  preset:\n    name: phi-4-mini-instruct\n'})}),"\n",(0,r.jsx)(n.p,{children:"Then apply the workspace:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f phi-4-workspace.yaml\n"})}),"\n",(0,r.jsx)(n.h2,{id:"supported-azure-gpu-instance-types",children:"Supported Azure GPU Instance Types"}),"\n",(0,r.jsxs)(n.p,{children:["The GPU provisioner supports various Azure GPU SKUs, see ",(0,r.jsx)(n.a,{href:"https://github.com/kaito-project/kaito/blob/main/pkg/sku/azure_sku_handler.go",children:"supported options here"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["For the complete list and specifications, see the ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/sizes-gpu",children:"Azure GPU-optimized VM sizes documentation"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"clean-up",children:"Clean Up"}),"\n",(0,r.jsx)(n.p,{children:"To remove the auto-provisioning setup:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Uninstall GPU provisioner\nhelm uninstall gpu-provisioner -n gpu-provisioner\n\n# Delete the managed identity (optional)\naz identity delete --name $IDENTITY_NAME -g $RESOURCE_GROUP\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var s=i(6540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);